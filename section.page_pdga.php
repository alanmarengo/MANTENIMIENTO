<link rel="stylesheet" type="text/css" href="./css/page_template.css" />

<div id="page_pdga" class="page page_template">
    <div class="row">
        <div class="section-sticky">
            <div class="col-md-12 page-title">
                Plan Director de Gestión Ambiental - PDGA
            </div>

            <div class="col-md-12 top-buttons">
                <a id="link-temas" href="#" data-target="#temas">
                    PLAN DE GESTI&Oacute;N AMBIENTAL
                </a>
                <a id="link-plan" href="#" data-target="#plan">
                    DISTRIBUCI&Oacute;N TERRITORIAL DE PROGRAMAS PGA
                </a>
                <a id="link-programas" href="#" data-target="#programas">
                    PROGRAMAS Y SUBPROGRAMAS DEL PGA
                </a>
                <a id="link-porarea" href="#" data-target="#porarea">
                    BUSCADOR DE PROGRAMAS Y SUBPROGRAMAS
                </a>
            </div>
        </div>

        <div class="col-md-12 section-a temas">
            <a id="temas"></a>
            <h3 style="color: #666;">PLAN DE GESTI&Oacute;N AMBIENTAL</h3>

            <div class="row" style="padding-left: 2em; padding-right: 2em;">
                <div class="col-md-12" style="margin-bottom: 50px; font-size: 16px;">
                    EL Plan de Gestión Ambiental (PGA) planifica y ejecuta las actividades tendientes a darle sostenibilidad al proyecto en sus distintas etapas, organiza las medidas y las recomendaciones que surgen del <a target="_blank" href="/page_antecedentes.php">Estudio de Impacto Ambiental</a> para mitigar los impactos sobre el medio físico, biótico y socioeconómico, y potenciar las oportunidades.
                </div>

                <img id="uxCaminito" src="./images/pdga_temas.jpg" usemap="#uxCaminitoMap"
                    style="width: 100%; height: auto;" />
                <map name='uxCaminitoMap'>
                    <area shape='circle' id="3" id2='aves' coords='226,57,50' href='' />
                    <area shape='circle' id="7" id2='peces' coords='129,63,50' href='' />
                    <area shape='circle' id="5" id2='humedales' coords='60,135,50' href='' />
                    <area shape='circle' id="8" id2='vegetacion' coords='59,239,50' href='' />
                    <area shape='circle' id="4" id2='fauna' coords='130,311,50' href='' />
                    <area shape='circle' id="6" id2='limnologia' coords='230,312,50' href='' />
                    <area shape='circle' id="9" id2='aguas' coords='302,239,52' href='' />
                    <area shape='circle' id="15" id2='sedimentos' coords='322,137,53' href='' />
                    <area shape='circle' id="14" id2='hidrologia' coords='391,63,50' href='' />
                    <area shape='circle' id="13" id2='glaciares' coords='494,61,50' href='' />
                    <area shape='circle' id="11" id2='geologia' coords='563,134,50' href='' />
                    <area shape='circle' id="10" id2='gases' coords='584,235,56' href='' />
                    <area shape='circle' id="16" id2='suelos' coords='656,316,50' href='' />
                    <area shape='circle' id="12" id2='gestion' coords='755,308,50' href='' />
                    <area shape='circle' id="20" id2='patrimonio' coords='826,240,50' href='' />
                    <area shape='circle' id="22" id2='recursos' coords='843,140,50' href='' />
                    <area shape='circle' id="24" id2='salud' coords='913,65,55' href='' />
                    <area shape='circle' id="19" id2='comunicacion' coords='1020,65,52' href='' />
                    <area shape='circle' id="23" id2='relaciones' coords='1090,138,50' href='' />
                    <area shape='circle' id="21" id2='pueblos' coords='1089,240,50' href='' />
                    <area shape='circle' id="18" id2='aspectos' coords='1017,309,50' href='' />
                    <area shape='circle' id="17" id2='articulacion2' coords='921,312,50' href='' />
                </map>
            </div>
        </div>

        <div class="col-md-12 section-b plan">
            <a id="plan"></a>
            <h3 style="color: #666;">DISTRIBUCI&Oacute;N TERRITORIAL DE PROGRAMAS PGA</h3>

            <div class="row" style="padding-left: 2em; padding-right: 2em;">
                <div class="col-md-12 parrafos">
                    <div class="embed-responsive" style="padding-top: 40%;">
                        <iframe src="./geovisor.pdga.php" frameborder="0"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-12 section-a programas">
            <a id="programas"></a>
            <h3 style="color: #666;">PROGRAMAS Y SUBPROGRAMAS DEL PGA</h3>

            <div class="row" style="padding-left: 2em; padding-right: 2em;">
                <div class="col-md-6 parrafos">
                    <p>
EL PGA está conformado por un conjunto de programas y subprogramas que abarcan las etapas de construcción y de operación de los aprovechamientos, además de algunos programas especiales que tiene una ejecución permanente (que trascienden la etapa de obra).                        
                        <br />
                        <br />
La estructura de programas y subprogramas surge de Estudio de Impacto Ambiental, que es una metodología sistemática para encarar la identificación y caracterización de las posibles alteraciones del ambiente y para proponer medidas de mitigación de los impactos negativos y de potenciación de los positivos.                        
                        <br />
                        <br />
Entre los programas especiales y de la etapa de construcción, el PGA aborda 90 temáticas específicas. Para su mejor exposición, se han clasificado en 22 temas clave, considerando las áreas biótica, física y social. 
                        <br />
                        <br />
                    </p>
                </div>
                <div class="col-md-6 parrafos">
                    <p>
La ejecución de algunos programas del PGA está a cargo del Comitente (Estado Nacional), otros de la UTE Represas Patagonia (contratista) y otros son de responsabilidad compartida entre ambos. En los casos correspondientes, el trabajo se articula con las autoridades respectivas de la provincia de Santa Cruz, con distintas instituciones del sistema científico argentino o con otros organismos del Estado Nacional o provincial. 
                        <br />
                        <br />
El alcance territorial de los programas y subprogramas depende de cada uno en particular: algunos se ejecutan en zona de obra, otros en áreas específicas (por ejemplo, el programa de macá tobiano realiza campañas en zonas de cría y de invernada: lagunas de la meseta central y estuario), otros a nivel de cuenca y algunos –en general, los del área social- a nivel provincial.
                        <br />
                        <br />
                    </p>
                </div>
            </div>

            <h3 style="color: #666;">RESUMEN DE PROGRAMAS/SUBPROGRAMAS:</h3>

            <div class="embed-responsive" style="padding-top: 50%;">
                <!--<iframe src="http://observatorio.ieasa.com.ar/indicadores-embed.php?ind_id=6" frameborder="0"></iframe>-->
                <!--<iframe src="./indicadores-embed.php?ind_id=6" frameborder="0"></iframe>-->
            </div>

            <h3 style="color: #666;">SISTEMA DE INFORMACI&Oacute;N AMBIENTAL (SIA-AHRSC)</h3>

            <div class="row" style="padding-left: 2em; padding-right: 2em;">
                <div class="col-md-6 parrafos">
                    <p>
El SIA AHRSC es un sistema integrado de información que organiza y asiste a la gestión ambiental del proyecto AHRSC. Fue diseñado a partir de un complejo sistema de información ambiental y de la ingeniería civil y electromecánica para conformar un todo funcional y dinámico para su consulta, accesibilidad y difusión.                        
                        <br />
                        <br />
El SIA contiene y distingue la información vinculada al PGA, estudios e informes, capas de información espacial en formato georreferenciado, datos y series estadísticas de los monitoreos de los programas y subprogramas y material audiovisual de los trabajos de campo.
                        <br />
                        <br />
                    </p>
                </div>
                <div class="col-md-6 parrafos">
                    <p>
Las tecnologías aplicadas a la información de datos espaciales (SIG) han permitido diseñar en el SIA, el subsistema del PGA con métodos eficientes para la producción y uso de los datos geográficos y no geográficos, facilitando la evolución y el crecimiento continuo de los programas y subprogramas. El SIA, es una gran base de datos que constituye el “core” del <a target="_blank" href="./page_acercade.php">Observatorio AHRSC</a>, una plataforma que provee las herramientas para la gestión del conocimiento interdisciplinar y participativo de la información ambiental del proyecto.
                        <br />
                        <br />
El SIA conforma una Infraestructura de Datos Espaciales (IDE), un nodo dentro en una amplia red que distribuye información a partir de protocolos internacionales y que permite generar canales de comunicación y trabajo participativo fortaleciendo las vinculaciones interinstitucionales generadas por el proyecto y facilitadas desde la plataforma del Observatorio.
                        <br />
                        <br />
                    </p>
                </div>
            </div>

            <div class="embed-responsive" style="padding-top: 51%;">
                <!--<iframe src="http://observatorio.ieasa.com.ar/indicadores-embed.php?ind_id=7" frameborder="0"></iframe>-->
                <!--<iframe scrolling="no" src="./indicadores-embed.php?ind_id=7" frameborder="0"></iframe>-->
            </div>
        </div>

        <div class="col-md-12 section-b porarea">
            <a id="porarea"></a>
            <h3 style="color: #666;">BUSCADOR DE PROGRAMAS/SUBPROGRAMAS</h3>

            <div class="row" style="padding-left: 2em; padding-right: 2em;">
                <div class="col-md-12 parrafos">
                    <div id="uxProgramas" class="programas">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="uxFicha" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body" style="min-height: 500px;">
                    <div class="row">
                        <div class="col-md-12" style="padding: 5px 40px;">
                            <div class="row" style="border-bottom: solid 1px #ccc; font-size: 14px;">
                                <div id="uxFichaTitulo" class="col-md-11"
                                    style="text-transform: uppercase; padding: 0px 0px 10px 0px; font-weight: bolder; color: #333;">
                                    uxFichaTitulo
                                </div>
                                <div class="col-md-1 text-right" <a href="#" class="close" data-dismiss="modal"
                                    style="cursor: pointer;">
                                    <i class="fa fa-times"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="row pop-ficha">
                                <div class="col-md-12" style="padding: 0px; margin: 0px;">
                                    <ul class="nav nav-tabs" id="uxFichaTabs" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="descripcion-tab" data-toggle="tab"
                                                href="#descripcion" role="tab">DESCRIPCI&Oacute;N</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="mapa-tab" data-toggle="tab" href="#mapa"
                                                role="tab">MAPA</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="multimedia-tab" data-toggle="tab" href="#multimedia"
                                                role="tab">MULTIMEDIA</a>
                                        </li>
                                    </ul>

                                    <div class="tab-content" id="uxFichaTabContent">
                                        <div class="tab-pane fade show active" id="descripcion" role="tabpanel" style="padding-top: 10px;">
                                            <div id="uxPopTexto" class="pop-content">
                                                uxPopTexto
                                            </div>
                                            <div style="text-align: center;">
                                                <a target="_blank" id="uxVerFicha" href="#" class="pop-button"
                                                    style="width: 49%; display: block; float: left; margin-right: 10px;">
                                                    <i class="far fa-file-pdf"></i>
                                                    VER FICHA
                                                </a>
                                                <a target="_blank" id="uxVerRecursos" href="#" class="pop-button"
                                                    style="width: 49%; display: block; float: left;">
                                                    <i class="fas fa-file-medical"></i>
                                                    VER RECURSOS ASOCIADOS
                                                </a>
                                            </div>

                                            <div style="margin-top: 50px; margin-left: 30px;">
                                                <div id="uxFichaProgramas" class="programas"
                                                    style="padding: 10px;">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="mapa" role="tabpanel" style="padding-top: 10px;">
                                            <div class="embed-responsive" style="padding-top: 50%;">
                                                <iframe id="uxMapa" src="" frameborder="0"></iframe>
                                            </div>
                                        </div>

                                        <div class="tab-pane fade" id="multimedia" role="tabpanel" style="padding-top: 10px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<link href="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js"></script>
<script type="text/javascript" src="./js/caminito_model.js"></script>
<script type="text/javascript" src="./js/imageMapResizer.min.js"></script>
<script type='text/javascript'>
$(document).ready(function() {
    $('map').imageMapResize();

    $("map area").click(function() {
        var id = parseInt($(this).attr('id'));
        loadFicha(id);
        return false;
    });

    function loadFicha(id) {
        let qs = {
            tema_id: id
        };
        let url = GlobalApiUrl + '/pdga_get_popup.php?' + jQuery.param(qs);

        $.getJSON(url, function(data) {
            var item = data[0];

            $('#uxFichaTitulo').html(item.tema_nombre);
            $('#uxPopTexto').html(item.tema_desc);

            if(item.tema_ficha_path != '') {
                $('#uxVerFicha').attr('href', item.tema_ficha_path)
            }
            else {
                $('#uxVerFicha').removeAttr('href')
            }
            $('#uxVerRecursos').attr('href', item.tema_recursos_asociados)
            $('#uxMapa').attr('src', item.tema_minigeovisor)

            // DESTROY PREVIOUS FOTORAMA
            $('#multimedia').html('').prepend(`
                <div id="fotorama" class="fotorama" data-auto="false">
                </div>                                        
            `)

            var imagenes = []
            item.tema_imagenes.forEach(imagen => {
                imagenes.push({
                    img: imagen,
                    tumb: imagen
                })
            })
            $('.fotorama').fotorama({
                width: '100%',
                nav: 'thumbs',
                data: imagenes
            });

            loadProgramasFichas(item.tema_id, '#uxFichaProgramas');
            
            $('#descripcion-tab').tab('show');
            $('#uxFicha').modal('show');
        });
    }

    $('.section-sticky a').on('click', function() {
        $('.section-sticky a').removeClass('selected');
        $(this).addClass('selected');

        let selector = $(this).data('target');
        $('html, body').animate({
            scrollTop: $(selector).offset().top - 200
        }, 500)
    });

    let target = $.urlParam('target');
    if (target) {
        // LINKS MENU TOP
        $('#link-' + target).trigger('click');
    }

    let pop = $.urlParam('pop');
    if (pop) {
        // APERTURA POP DE CAMINITO DESDE QS
        $('#link-temas').trigger('click');
        loadFicha(pop);
    }

    $('.pop-button2').hover(
        function() {
            let key = $(this).data('key');
            $(this).css('background-image', 'url("./images/icono-' + key + '-relleno-hover.png")')
        },
        function() {
            let key = $(this).data('key');
            $(this).css('background-image', 'url("./images/icono-' + key + '-relleno.png")')
        }
    )

    loadProgramas('#uxProgramas');




    function loadProgramas(container) {
        let url = GlobalApiUrl + '/php/get-programas.php';

        $.getJSON(url, function(data) {
            let html = renderProgramas(container, data.programas, 0);
            $(container).html(html);

            $('.panel-collapse').on('hidden.bs.collapse', function() {
                var id = $(this).data('flecha');
                $('#' + id)
                    .removeClass('fa-chevron-up')
                    .addClass('fa-chevron-down')
            })

            $('.panel-collapse').on('shown.bs.collapse', function() {
                var id = $(this).data('flecha');
                $('#' + id)
                    .removeClass('fa-chevron-down')
                    .addClass('fa-chevron-up')
            })
        });
    }

    function renderProgramas(container, items, nivel) {
        let htmlItems = `<div style="margin-left: ${nivel * 40}px">`;
        items.forEach(item => {
            htmlItems += renderPrograma(container, item, nivel)
        });
        htmlItems += '</div>';

        return htmlItems;
    }

    function renderPrograma(container, item, nivel) {
        let htmlItem = `
            <div class="programa-${nivel > 0 ? 'sub' : ''}item">
                <div class="row" style="cursor: pointer;" data-toggle="collapse" href="#${item.id}">
                    <div class="col-md-11">
                        ${item.name} ${item.subprogramas != null && item.subprogramas.length > 0 ? ` (${item.subprogramas.length})` : ''}
        `
        // TEMAS
        if (item.temas) {
            if (item.temas.length > 0) {
                item.temas.forEach(t => {
                    let tema = caminito.find(x => x.id === t.id);
                    htmlItem +=
                        `<span class="badge badge-primary" style="font-size: 12px; margin: 0px 6px; padding: 6px; background-color: ${tema.color};">${t.nombre}</span>`
                });
            }
        }

        let esFicha = !item.subprogramas || item.subprogramas.length == 0;

        htmlItem += `
                    </div>
                    <div class="col-md-1 text-right" style="font-size: 1.6em;">
                        <i id="flecha_${item.id}" class="fa fa-chevron-${esFicha ? 'down' : 'up'}"></i>
                    </div>
                </div>
        `

        htmlItem +=
            `<div class="collapse ${esFicha ? '' : 'show'} panel-collapse" data-flecha="flecha_${item.id}" id="${item.id}" style="margin-top: 8px;">`

        if (esFicha)
        {
            // DATA
            if (item.data) {
                htmlItem += `<table class="table table-sm table-hover table-striped">`
                Object.keys(item.data).forEach(d => {
                    htmlItem += `
                        <tr>
                            <td style="width: 20%; font-weight: bolder; border-top: none; padding: 4px; vertical-align: middle; text-transform: none;">
                                ${d}:
                            </td>
                            <td style="width: 80%; border-top: none; padding: 4px; vertical-align: middle; text-transform: none;">
                                ${item.data[d]}
                            </td>
                        </tr>
                    `;
                });
                htmlItem += `</table>`
            }
        } else
        {
            // SUBPROGRAMAS
            htmlItem += renderProgramas(container, item.subprogramas, nivel + 1)
        }

        htmlItem += `
                </div>
            </div>
        `

        return htmlItem;
    }

    function loadProgramasFichas(temaId, container) {
        $(container).html('');
        
        let qs = {
            tema_id: temaId
        };
        let url = GlobalApiUrl + '/php/get-programas.php?' + jQuery.param(qs);
        $.getJSON(url, function(data) {
            let html = renderProgramasFicha(container, data.programas, 0);
            $(container).html(html);
        });
    }

    function renderProgramasFicha(container, items, nivel) {
        let htmlItems = `<ul style="margin-left: ${nivel * 40}px">`;
        items.forEach(item => {
            htmlItems += renderProgramaFicha(container, item, nivel)
        });
        htmlItems += '</ul>';

        return htmlItems;
    }

    function renderProgramaFicha(container, item, nivel) {
        let htmlItem = `
            <li>
                ${item.name}
        `;

        if (item.subprogramas != null) {
            htmlItem += renderProgramasFicha(container, item.subprogramas, nivel + 1)
        }

        htmlItem += `</li>`

        return htmlItem;
    }
});
</script>
